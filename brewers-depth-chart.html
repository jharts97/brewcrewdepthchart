<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Milwaukee Brewers 2026 — Depth Chart</title>
<link href="https://fonts.googleapis.com/css2?family=Barlow+Condensed:wght@400;600;700;900&family=Barlow:wght@400;500;600&display=swap" rel="stylesheet">
<style>
  :root {
    --navy: #0a1628;
    --dark: #0d1f35;
    --mid: #122440;
    --card: #162d4a;
    --card-hover: #1c3a5e;
    --gold: #ffc629;
    --gold-dim: #c99b1a;
    --cream: #f5efe0;
    --muted: #7a9bbf;
    --accent: #4fc3f7;
    --red: #e74c3c;
    --green: #2ecc71;
    --border: rgba(255,198,41,0.15);
    --border-bright: rgba(255,198,41,0.5);
  }
  * { box-sizing: border-box; margin: 0; padding: 0; }
  body {
    background: var(--navy);
    color: var(--cream);
    font-family: 'Barlow', sans-serif;
    min-height: 100vh;
    overflow-x: hidden;
  }
  /* Background texture */
  body::before {
    content: '';
    position: fixed;
    inset: 0;
    background: 
      radial-gradient(ellipse 80% 50% at 50% -10%, rgba(255,198,41,0.06) 0%, transparent 70%),
      repeating-linear-gradient(0deg, transparent, transparent 39px, rgba(255,255,255,0.015) 40px),
      repeating-linear-gradient(90deg, transparent, transparent 39px, rgba(255,255,255,0.015) 40px);
    pointer-events: none;
    z-index: 0;
  }

  /* HEADER */
  header {
    position: relative;
    z-index: 10;
    background: linear-gradient(135deg, var(--dark) 0%, #0e1e36 100%);
    border-bottom: 2px solid var(--gold);
    padding: 0 24px;
    display: flex;
    align-items: center;
    gap: 20px;
    height: 72px;
  }
  .logo-area {
    display: flex;
    align-items: center;
    gap: 14px;
  }
  .ball-icon {
    width: 44px; height: 44px;
    background: var(--gold);
    border-radius: 50%;
    display: flex; align-items: center; justify-content: center;
    font-size: 22px;
    box-shadow: 0 0 20px rgba(255,198,41,0.4);
    flex-shrink: 0;
  }
  .team-name {
    font-family: 'Barlow Condensed', sans-serif;
    font-weight: 900;
    font-size: 26px;
    letter-spacing: 1px;
    line-height: 1;
  }
  .team-name span { color: var(--gold); }
  .season-badge {
    background: var(--gold);
    color: var(--navy);
    font-family: 'Barlow Condensed', sans-serif;
    font-weight: 900;
    font-size: 13px;
    padding: 3px 10px;
    border-radius: 3px;
    letter-spacing: 1px;
  }
  header .spacer { flex: 1; }
  .header-actions {
    display: flex;
    gap: 10px;
  }
  .btn {
    font-family: 'Barlow Condensed', sans-serif;
    font-weight: 700;
    font-size: 13px;
    letter-spacing: 0.5px;
    padding: 7px 16px;
    border-radius: 4px;
    border: none;
    cursor: pointer;
    transition: all 0.15s;
  }
  .btn-primary { background: var(--gold); color: var(--navy); }
  .btn-primary:hover { background: #ffe066; transform: translateY(-1px); }
  .btn-outline { background: transparent; color: var(--gold); border: 1.5px solid var(--gold); }
  .btn-outline:hover { background: rgba(255,198,41,0.1); }
  .btn-danger { background: var(--red); color: white; }
  .btn-danger:hover { background: #c0392b; }
  .btn-sm { padding: 4px 10px; font-size: 11px; }

  /* TABS */
  .tabs {
    position: relative; z-index: 10;
    display: flex;
    background: var(--dark);
    border-bottom: 1px solid var(--border);
    padding: 0 24px;
    gap: 4px;
  }
  .tab {
    font-family: 'Barlow Condensed', sans-serif;
    font-weight: 700;
    font-size: 14px;
    letter-spacing: 0.5px;
    color: var(--muted);
    padding: 12px 20px 10px;
    cursor: pointer;
    border-bottom: 2px solid transparent;
    transition: all 0.15s;
    background: none;
    border-top: none; border-left: none; border-right: none;
    white-space: nowrap;
  }
  .tab:hover { color: var(--cream); }
  .tab.active { color: var(--gold); border-bottom-color: var(--gold); }

  /* MAIN */
  main { position: relative; z-index: 1; padding: 24px; }
  .panel { display: none; }
  .panel.active { display: block; }

  /* SECTION HEADERS */
  .section-title {
    font-family: 'Barlow Condensed', sans-serif;
    font-weight: 900;
    font-size: 11px;
    letter-spacing: 3px;
    color: var(--gold);
    text-transform: uppercase;
    margin-bottom: 14px;
    display: flex;
    align-items: center;
    gap: 10px;
  }
  .section-title::after {
    content: '';
    flex: 1;
    height: 1px;
    background: linear-gradient(90deg, var(--border-bright), transparent);
  }

  /* DEPTH CHART GRID */
  .depth-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
    gap: 20px;
    margin-bottom: 32px;
  }
  .position-card {
    background: var(--card);
    border: 1px solid var(--border);
    border-radius: 8px;
    overflow: hidden;
    transition: border-color 0.2s;
  }
  .position-card:hover { border-color: var(--border-bright); }
  .pos-header {
    background: linear-gradient(135deg, var(--mid), var(--dark));
    padding: 10px 14px;
    display: flex;
    align-items: center;
    gap: 10px;
    border-bottom: 1px solid var(--border);
  }
  .pos-tag {
    background: var(--gold);
    color: var(--navy);
    font-family: 'Barlow Condensed', sans-serif;
    font-weight: 900;
    font-size: 14px;
    padding: 2px 8px;
    border-radius: 3px;
    min-width: 36px;
    text-align: center;
  }
  .pos-name {
    font-family: 'Barlow Condensed', sans-serif;
    font-weight: 700;
    font-size: 14px;
    color: var(--muted);
    letter-spacing: 0.5px;
  }
  .pos-body { padding: 0; }
  .player-row {
    display: flex;
    align-items: center;
    gap: 10px;
    padding: 9px 14px;
    border-bottom: 1px solid rgba(255,255,255,0.04);
    cursor: grab;
    transition: background 0.1s;
    position: relative;
  }
  .player-row:last-child { border-bottom: none; }
  .player-row:hover { background: rgba(255,255,255,0.04); }
  .player-row.dragging { opacity: 0.4; cursor: grabbing; }
  .player-row.drag-over { background: rgba(255,198,41,0.1); border-top: 2px solid var(--gold); }
  .depth-num {
    font-family: 'Barlow Condensed', sans-serif;
    font-weight: 700;
    font-size: 13px;
    color: var(--muted);
    min-width: 18px;
  }
  .depth-num.starter { color: var(--gold); }
  .player-avatar {
    width: 30px; height: 30px;
    border-radius: 50%;
    display: flex; align-items: center; justify-content: center;
    font-family: 'Barlow Condensed', sans-serif;
    font-weight: 900;
    font-size: 12px;
    flex-shrink: 0;
    border: 1.5px solid rgba(255,255,255,0.1);
  }
  .player-info { flex: 1; min-width: 0; }
  .player-name {
    font-family: 'Barlow Condensed', sans-serif;
    font-weight: 700;
    font-size: 15px;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
  }
  .player-meta {
    font-size: 11px;
    color: var(--muted);
    display: flex;
    gap: 6px;
  }
  .badge {
    font-size: 10px;
    padding: 1px 5px;
    border-radius: 2px;
    font-family: 'Barlow Condensed', sans-serif;
    font-weight: 700;
  }
  .badge-r { background: rgba(79,195,247,0.2); color: var(--accent); }
  .badge-l { background: rgba(46,204,113,0.2); color: var(--green); }
  .badge-s { background: rgba(155,89,182,0.2); color: #bb86fc; }
  .badge-il { background: rgba(231,76,60,0.2); color: var(--red); }
  .badge-minors { background: rgba(255,198,41,0.15); color: var(--gold-dim); }
  .badge-rookie { background: rgba(46,204,113,0.15); color: var(--green); }
  .row-actions {
    display: flex;
    gap: 4px;
    opacity: 0;
    transition: opacity 0.15s;
  }
  .player-row:hover .row-actions { opacity: 1; }
  .icon-btn {
    background: none;
    border: none;
    color: var(--muted);
    cursor: pointer;
    padding: 3px;
    font-size: 13px;
    border-radius: 3px;
    transition: all 0.1s;
    line-height: 1;
  }
  .icon-btn:hover { color: var(--gold); background: rgba(255,198,41,0.1); }
  .icon-btn.delete:hover { color: var(--red); background: rgba(231,76,60,0.1); }
  .add-player-row {
    padding: 8px 14px;
    display: flex;
    align-items: center;
    gap: 8px;
    border-top: 1px dashed rgba(255,198,41,0.2);
    cursor: pointer;
    transition: background 0.1s;
    color: var(--muted);
    font-size: 12px;
    font-family: 'Barlow Condensed', sans-serif;
    font-weight: 600;
    letter-spacing: 0.5px;
  }
  .add-player-row:hover { background: rgba(255,198,41,0.05); color: var(--gold); }

  /* LINEUP BUILDER */
  .lineup-container {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 24px;
  }
  @media (max-width: 900px) { .lineup-container { grid-template-columns: 1fr; } }
  .lineup-card {
    background: var(--card);
    border: 1px solid var(--border);
    border-radius: 8px;
    overflow: hidden;
  }
  .lineup-header {
    background: linear-gradient(135deg, var(--mid), var(--dark));
    padding: 12px 16px;
    border-bottom: 1px solid var(--border);
    display: flex;
    align-items: center;
    justify-content: space-between;
  }
  .lineup-title {
    font-family: 'Barlow Condensed', sans-serif;
    font-weight: 900;
    font-size: 16px;
    letter-spacing: 1px;
  }
  .batting-order-row {
    display: flex;
    align-items: center;
    padding: 10px 14px;
    border-bottom: 1px solid rgba(255,255,255,0.04);
    gap: 12px;
    cursor: grab;
    transition: background 0.1s;
  }
  .batting-order-row:hover { background: rgba(255,255,255,0.04); }
  .batting-order-row.drag-over { background: rgba(255,198,41,0.1); border-top: 2px solid var(--gold); }
  .order-num {
    font-family: 'Barlow Condensed', sans-serif;
    font-weight: 900;
    font-size: 20px;
    color: var(--gold);
    min-width: 24px;
  }
  .lineup-pos {
    font-family: 'Barlow Condensed', sans-serif;
    font-weight: 700;
    font-size: 13px;
    color: var(--muted);
    min-width: 28px;
  }
  .lineup-player {
    flex: 1;
    font-family: 'Barlow Condensed', sans-serif;
    font-weight: 700;
    font-size: 15px;
  }
  .lineup-select {
    font-family: 'Barlow Condensed', sans-serif;
    font-weight: 600;
    font-size: 13px;
    background: var(--mid);
    color: var(--cream);
    border: 1px solid var(--border);
    border-radius: 4px;
    padding: 4px 8px;
    cursor: pointer;
    flex: 1;
  }
  .lineup-select:focus { outline: none; border-color: var(--gold); }

  /* ROTATION */
  .rotation-grid {
    display: grid;
    grid-template-columns: repeat(5, 1fr);
    gap: 12px;
    margin-bottom: 24px;
  }
  @media (max-width: 700px) { .rotation-grid { grid-template-columns: repeat(2, 1fr); } }
  .rotation-slot {
    background: var(--card);
    border: 1px solid var(--border);
    border-radius: 8px;
    padding: 14px 12px;
    text-align: center;
    transition: border-color 0.2s;
  }
  .rotation-slot:hover { border-color: var(--border-bright); }
  .slot-num {
    font-family: 'Barlow Condensed', sans-serif;
    font-weight: 900;
    font-size: 11px;
    letter-spacing: 2px;
    color: var(--muted);
    margin-bottom: 8px;
    text-transform: uppercase;
  }
  .rotation-player {
    font-family: 'Barlow Condensed', sans-serif;
    font-weight: 700;
    font-size: 16px;
    margin-bottom: 4px;
  }
  .rotation-select {
    font-family: 'Barlow Condensed', sans-serif;
    font-weight: 600;
    font-size: 12px;
    background: var(--mid);
    color: var(--cream);
    border: 1px solid var(--border);
    border-radius: 4px;
    padding: 5px 4px;
    cursor: pointer;
    width: 100%;
    text-align: center;
    margin-top: 8px;
  }
  .rotation-select:focus { outline: none; border-color: var(--gold); }

  /* BULLPEN */
  .bullpen-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(160px, 1fr));
    gap: 10px;
  }
  .bullpen-slot {
    background: var(--card);
    border: 1px solid var(--border);
    border-radius: 6px;
    padding: 10px 12px;
    display: flex;
    align-items: center;
    gap: 10px;
    transition: border-color 0.2s;
  }
  .bullpen-slot:hover { border-color: var(--border-bright); }
  .bullpen-role {
    font-family: 'Barlow Condensed', sans-serif;
    font-weight: 700;
    font-size: 11px;
    letter-spacing: 1px;
    color: var(--muted);
    white-space: nowrap;
  }
  .bullpen-name {
    font-family: 'Barlow Condensed', sans-serif;
    font-weight: 700;
    font-size: 14px;
    flex: 1;
  }

  /* MODAL */
  .modal-overlay {
    display: none;
    position: fixed;
    inset: 0;
    background: rgba(0,0,0,0.7);
    z-index: 100;
    align-items: center;
    justify-content: center;
  }
  .modal-overlay.open { display: flex; }
  .modal {
    background: var(--card);
    border: 1px solid var(--border-bright);
    border-radius: 10px;
    padding: 24px;
    width: 380px;
    max-width: 95vw;
    box-shadow: 0 20px 60px rgba(0,0,0,0.5);
  }
  .modal h3 {
    font-family: 'Barlow Condensed', sans-serif;
    font-weight: 900;
    font-size: 20px;
    margin-bottom: 18px;
    color: var(--gold);
  }
  .form-group { margin-bottom: 14px; }
  .form-label {
    font-family: 'Barlow Condensed', sans-serif;
    font-weight: 700;
    font-size: 12px;
    letter-spacing: 0.5px;
    color: var(--muted);
    display: block;
    margin-bottom: 5px;
    text-transform: uppercase;
  }
  .form-input, .form-select {
    width: 100%;
    background: var(--mid);
    color: var(--cream);
    border: 1px solid var(--border);
    border-radius: 5px;
    padding: 8px 12px;
    font-family: 'Barlow', sans-serif;
    font-size: 14px;
  }
  .form-input:focus, .form-select:focus { outline: none; border-color: var(--gold); }
  .modal-actions { display: flex; gap: 10px; margin-top: 20px; justify-content: flex-end; }

  /* NOTES */
  .notes-area {
    width: 100%;
    background: var(--mid);
    color: var(--cream);
    border: 1px solid var(--border);
    border-radius: 5px;
    padding: 10px 12px;
    font-family: 'Barlow', sans-serif;
    font-size: 13px;
    min-height: 80px;
    resize: vertical;
  }
  .notes-area:focus { outline: none; border-color: var(--gold); }

  /* DRAG HINT */
  .drag-hint {
    font-size: 11px;
    color: var(--muted);
    display: flex;
    align-items: center;
    gap: 5px;
    margin-bottom: 12px;
    opacity: 0.7;
  }

  /* Scrollbar */
  ::-webkit-scrollbar { width: 6px; }
  ::-webkit-scrollbar-track { background: var(--dark); }
  ::-webkit-scrollbar-thumb { background: var(--border-bright); border-radius: 3px; }

  /* Stat chips for overview */
  .stat-row {
    display: flex;
    gap: 12px;
    flex-wrap: wrap;
    margin-bottom: 24px;
  }
  .stat-chip {
    background: var(--card);
    border: 1px solid var(--border);
    border-radius: 6px;
    padding: 10px 16px;
    text-align: center;
    min-width: 100px;
  }
  .stat-chip-val {
    font-family: 'Barlow Condensed', sans-serif;
    font-weight: 900;
    font-size: 24px;
    color: var(--gold);
    line-height: 1;
  }
  .stat-chip-lbl {
    font-size: 10px;
    color: var(--muted);
    text-transform: uppercase;
    letter-spacing: 1px;
    margin-top: 3px;
  }
  .editable-name {
    cursor: text;
    border-bottom: 1px dashed transparent;
    transition: border-color 0.15s;
  }
  .editable-name:hover { border-bottom-color: var(--gold); }
</style>
</head>
<body>

<header>
  <div class="logo-area">
    <div class="ball-icon">⚾</div>
    <div>
      <div class="team-name">MILWAUKEE <span>BREWERS</span></div>
    </div>
    <div class="season-badge">2026</div>
  </div>
  <div class="spacer"></div>
  <div class="header-actions">
    <button class="btn btn-outline" onclick="resetAll()">↺ Reset</button>
    <button class="btn btn-primary" onclick="exportNotes()">⬇ Export Notes</button>
  </div>
</header>

<div class="tabs">
  <button class="tab active" onclick="switchTab('depth')">Depth Chart</button>
  <button class="tab" onclick="switchTab('lineup')">Lineup Builder</button>
  <button class="tab" onclick="switchTab('pitching')">Pitching Staff</button>
</div>

<main>
<!-- DEPTH CHART TAB -->
<div id="panel-depth" class="panel active">
  <div class="stat-row">
    <div class="stat-chip"><div class="stat-chip-val">97</div><div class="stat-chip-lbl">2025 Wins</div></div>
    <div class="stat-chip"><div class="stat-chip-val">1st</div><div class="stat-chip-lbl">NL Central</div></div>
    <div class="stat-chip"><div class="stat-chip-val" id="roster-count">26</div><div class="stat-chip-lbl">Players</div></div>
    <div class="stat-chip"><div class="stat-chip-val" id="il-count">2</div><div class="stat-chip-lbl">On IL</div></div>
  </div>
  <p class="drag-hint">⟺ Drag players within a position to reorder depth. Hover a row to edit or remove. Click + to add players.</p>
  <div class="depth-grid" id="depth-grid"></div>
</div>

<!-- LINEUP BUILDER TAB -->
<div id="panel-lineup" class="panel">
  <div class="lineup-container">
    <div class="lineup-card">
      <div class="lineup-header">
        <div class="lineup-title">⚾ BATTING ORDER</div>
        <button class="btn btn-outline btn-sm" onclick="autoFillLineup()">Auto Fill</button>
      </div>
      <div id="batting-order"></div>
    </div>
    <div>
      <div class="section-title">BENCH</div>
      <div id="bench-display" class="lineup-card" style="padding:14px;"></div>
      <div style="margin-top:20px;">
        <div class="section-title">PROJECTED NOTES</div>
        <div class="lineup-card" style="padding: 14px;">
          <textarea class="notes-area" id="lineup-notes" placeholder="Add your lineup analysis, thoughts, projections...&#10;&#10;e.g. Chourio bats 3rd vs RHP, Yelich 4th. Turang leads off with speed..." style="width:100%;"></textarea>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- PITCHING TAB -->
<div id="panel-pitching" class="panel">
  <div class="section-title">STARTING ROTATION</div>
  <div class="rotation-grid" id="rotation-grid"></div>
  <div class="section-title" style="margin-top: 8px;">BULLPEN</div>
  <div class="bullpen-grid" id="bullpen-grid"></div>
  <div style="margin-top:20px;">
    <div class="section-title">PITCHING NOTES</div>
    <div class="lineup-card" style="padding: 14px;">
      <textarea class="notes-area" id="pitching-notes" placeholder="Add pitching staff analysis...&#10;&#10;e.g. Woodruff returns from TJS to lead rotation. Megill locks down the 9th with 30+ saves." style="width:100%;"></textarea>
    </div>
  </div>
</div>
</main>

<!-- ADD PLAYER MODAL -->
<div class="modal-overlay" id="add-modal">
  <div class="modal">
    <h3 id="modal-title">Add Player</h3>
    <div class="form-group">
      <label class="form-label">Player Name</label>
      <input class="form-input" id="modal-name" type="text" placeholder="e.g. Jackson Chourio">
    </div>
    <div class="form-group">
      <label class="form-label">Bats</label>
      <select class="form-select" id="modal-bats">
        <option value="R">Right (R)</option>
        <option value="L">Left (L)</option>
        <option value="S">Switch (S)</option>
      </select>
    </div>
    <div class="form-group">
      <label class="form-label">Status</label>
      <select class="form-select" id="modal-status">
        <option value="">Active</option>
        <option value="il">IL</option>
        <option value="minors">Minors</option>
        <option value="rookie">Rookie</option>
      </select>
    </div>
    <div class="form-group">
      <label class="form-label">Note (optional)</label>
      <input class="form-input" id="modal-note" type="text" placeholder="e.g. Day-to-day, TJS recovery">
    </div>
    <div class="modal-actions">
      <button class="btn btn-outline" onclick="closeModal()">Cancel</button>
      <button class="btn btn-primary" onclick="savePlayer()">Add Player</button>
    </div>
  </div>
</div>

<script>
// ============================================================
// DATA
// ============================================================
const COLORS = ['#e74c3c','#e67e22','#f1c40f','#2ecc71','#1abc9c','#3498db','#9b59b6','#e91e63'];
function avatarColor(name) {
  let h = 0; for (let c of name) h = (h * 31 + c.charCodeAt(0)) % COLORS.length;
  return COLORS[h];
}
function initials(name) {
  return name.split(' ').map(p=>p[0]).join('').slice(0,2).toUpperCase();
}

const defaultData = {
  positions: [
    {
      id:'C', abbr:'C', name:'Catcher',
      players:[
        {name:'William Contreras', bats:'R', status:'il', note:'Day-To-Day'},
        {name:'Reese McGuire', bats:'L', status:''},
        {name:'Jeferson Quero', bats:'R', status:'rookie', note:'Top prospect'},
        {name:'Gary Sanchez', bats:'R', status:'il', note:'Day-To-Day'},
      ]
    },
    {
      id:'1B', abbr:'1B', name:'First Base',
      players:[
        {name:'Andrew Vaughn', bats:'R', status:''},
        {name:'Jake Bauers', bats:'L', status:''},
        {name:'Tyler Black', bats:'L', status:''},
      ]
    },
    {
      id:'2B', abbr:'2B', name:'Second Base',
      players:[
        {name:'Brice Turang', bats:'L', status:''},
        {name:'David Hamilton', bats:'L', status:''},
        {name:'Luis Rengifo', bats:'S', status:''},
        {name:'Sal Frelick', bats:'L', status:''},
      ]
    },
    {
      id:'SS', abbr:'SS', name:'Shortstop',
      players:[
        {name:'Joey Ortiz', bats:'R', status:''},
        {name:'Brice Turang', bats:'L', status:''},
        {name:'Jett Williams', bats:'R', status:'rookie'},
        {name:'David Hamilton', bats:'L', status:''},
      ]
    },
    {
      id:'3B', abbr:'3B', name:'Third Base',
      players:[
        {name:'Luis Rengifo', bats:'S', status:''},
        {name:'David Hamilton', bats:'L', status:''},
        {name:'Jett Williams', bats:'R', status:'rookie'},
        {name:'Sal Frelick', bats:'L', status:''},
      ]
    },
    {
      id:'LF', abbr:'LF', name:'Left Field',
      players:[
        {name:'Christian Yelich', bats:'L', status:''},
        {name:'Sal Frelick', bats:'L', status:''},
        {name:'Joey Wiemer', bats:'R', status:''},
      ]
    },
    {
      id:'CF', abbr:'CF', name:'Center Field',
      players:[
        {name:'Jackson Chourio', bats:'R', status:''},
        {name:'Sal Frelick', bats:'L', status:''},
        {name:'Joey Wiemer', bats:'R', status:''},
      ]
    },
    {
      id:'RF', abbr:'RF', name:'Right Field',
      players:[
        {name:'Sal Frelick', bats:'L', status:''},
        {name:'Joey Wiemer', bats:'R', status:''},
        {name:'Jackson Chourio', bats:'R', status:''},
      ]
    },
    {
      id:'DH', abbr:'DH', name:'Designated Hitter',
      players:[
        {name:'William Contreras', bats:'R', status:''},
        {name:'Andrew Vaughn', bats:'R', status:''},
        {name:'Christian Yelich', bats:'L', status:''},
      ]
    },
  ],
  rotation: [
    {slot:'ACE', name:'Brandon Woodruff', throws:'R', note:'TJS comeback'},
    {slot:'#2', name:'Colin Rea', throws:'R', note:''},
    {slot:'#3', name:'Tobias Myers', throws:'R', note:''},
    {slot:'#4', name:'Aaron Ashby', throws:'L', note:''},
    {slot:'#5', name:'TBD', throws:'R', note:'Open competition'},
  ],
  bullpen: [
    {role:'CLOSER', name:'Trevor Megill', throws:'R'},
    {role:'SETUP', name:'Abner Uribe', throws:'R'},
    {role:'SETUP', name:'Grant Anderson', throws:'R'},
    {role:'MID', name:'Jared Koenig', throws:'L'},
    {role:'MID', name:'Elvis Peguero', throws:'R'},
    {role:'MID', name:'Peter Strzelecki', throws:'R'},
    {role:'LOO', name:'Bryan Hudson', throws:'L'},
    {role:'MOPUP', name:'TBD', throws:'R'},
  ],
  lineup: [
    {pos:'CF', player:'Jackson Chourio'},
    {pos:'SS', player:'Joey Ortiz'},
    {pos:'LF', player:'Christian Yelich'},
    {pos:'DH', player:'William Contreras'},
    {pos:'C', player:'Reese McGuire'},
    {pos:'1B', player:'Andrew Vaughn'},
    {pos:'3B', player:'Luis Rengifo'},
    {pos:'2B', player:'Brice Turang'},
    {pos:'RF', player:'Sal Frelick'},
  ],
};

let state = JSON.parse(JSON.stringify(defaultData));

// Load from localStorage if available
try {
  const saved = localStorage.getItem('brewers2026');
  if (saved) state = JSON.parse(saved);
} catch(e){}

function saveState() {
  try { localStorage.setItem('brewers2026', JSON.stringify(state)); } catch(e){}
}

// ============================================================
// RENDER DEPTH CHART
// ============================================================
let dragSrc = null;
let addingToPos = null;

function renderDepth() {
  const grid = document.getElementById('depth-grid');
  grid.innerHTML = '';
  let total = 0, ilCount = 0;
  state.positions.forEach(pos => {
    total += pos.players.length;
    ilCount += pos.players.filter(p=>p.status==='il').length;
    const card = document.createElement('div');
    card.className = 'position-card';
    card.innerHTML = `
      <div class="pos-header">
        <div class="pos-tag">${pos.abbr}</div>
        <div class="pos-name">${pos.name}</div>
      </div>
      <div class="pos-body" id="pos-body-${pos.id}"></div>
      <div class="add-player-row" onclick="openAddModal('${pos.id}')">
        <span style="font-size:16px; color:var(--gold)">+</span> Add Player
      </div>
    `;
    grid.appendChild(card);
    renderPositionRows(pos);
  });
  document.getElementById('roster-count').textContent = total;
  document.getElementById('il-count').textContent = ilCount;
}

function renderPositionRows(pos) {
  const body = document.getElementById('pos-body-' + pos.id);
  if (!body) return;
  body.innerHTML = '';
  pos.players.forEach((player, i) => {
    const row = document.createElement('div');
    row.className = 'player-row';
    row.draggable = true;
    row.dataset.pos = pos.id;
    row.dataset.idx = i;
    const color = avatarColor(player.name);
    const badge = player.bats ? `<span class="badge badge-${player.bats.toLowerCase()}">${player.bats}</span>` : '';
    const statusBadge = player.status ? `<span class="badge badge-${player.status}">${player.status.toUpperCase()}</span>` : '';
    const note = player.note ? `<span>${player.note}</span>` : '';
    row.innerHTML = `
      <div class="depth-num ${i===0?'starter'!==''?'starter':''!==''?'':'' :''} ${i===0?'starter':''}">
        ${i===0 ? '★' : i+1}
      </div>
      <div class="player-avatar" style="background:${color}22; color:${color}; border-color:${color}44">
        ${initials(player.name)}
      </div>
      <div class="player-info">
        <div class="player-name editable-name" contenteditable="true" 
          onblur="renamePlayer('${pos.id}',${i},this.textContent)"
          onclick="this.focus()">${player.name}</div>
        <div class="player-meta">${badge}${statusBadge}${note}</div>
      </div>
      <div class="row-actions">
        <button class="icon-btn" onclick="moveUp('${pos.id}',${i})" title="Move up">↑</button>
        <button class="icon-btn" onclick="moveDown('${pos.id}',${i})" title="Move down">↓</button>
        <button class="icon-btn delete" onclick="removePlayer('${pos.id}',${i})" title="Remove">✕</button>
      </div>
    `;
    // Drag events
    row.addEventListener('dragstart', e => {
      dragSrc = {posId: pos.id, idx: i};
      e.dataTransfer.effectAllowed = 'move';
      setTimeout(()=>row.classList.add('dragging'), 0);
    });
    row.addEventListener('dragend', () => row.classList.remove('dragging'));
    row.addEventListener('dragover', e => { e.preventDefault(); row.classList.add('drag-over'); });
    row.addEventListener('dragleave', () => row.classList.remove('drag-over'));
    row.addEventListener('drop', e => {
      e.preventDefault();
      row.classList.remove('drag-over');
      if (!dragSrc || (dragSrc.posId === pos.id && dragSrc.idx === i)) return;
      if (dragSrc.posId === pos.id) {
        const arr = state.positions.find(p=>p.id===pos.id).players;
        const [moved] = arr.splice(dragSrc.idx, 1);
        arr.splice(i, 0, moved);
        saveState();
        renderDepth();
        renderLineupBuilder();
      }
    });
    body.appendChild(row);
  });
}

function moveUp(posId, idx) {
  const pos = state.positions.find(p=>p.id===posId);
  if (idx === 0) return;
  [pos.players[idx-1], pos.players[idx]] = [pos.players[idx], pos.players[idx-1]];
  saveState(); renderDepth();
}
function moveDown(posId, idx) {
  const pos = state.positions.find(p=>p.id===posId);
  if (idx >= pos.players.length-1) return;
  [pos.players[idx], pos.players[idx+1]] = [pos.players[idx+1], pos.players[idx]];
  saveState(); renderDepth();
}
function removePlayer(posId, idx) {
  const pos = state.positions.find(p=>p.id===posId);
  pos.players.splice(idx, 1);
  saveState(); renderDepth();
}
function renamePlayer(posId, idx, newName) {
  const pos = state.positions.find(p=>p.id===posId);
  if (pos && newName.trim()) pos.players[idx].name = newName.trim();
  saveState();
}

// ============================================================
// MODAL
// ============================================================
function openAddModal(posId) {
  addingToPos = posId;
  document.getElementById('modal-title').textContent = 'Add Player — ' + posId;
  document.getElementById('modal-name').value = '';
  document.getElementById('modal-bats').value = 'R';
  document.getElementById('modal-status').value = '';
  document.getElementById('modal-note').value = '';
  document.getElementById('add-modal').classList.add('open');
  setTimeout(()=>document.getElementById('modal-name').focus(), 100);
}
function closeModal() {
  document.getElementById('add-modal').classList.remove('open');
  addingToPos = null;
}
function savePlayer() {
  const name = document.getElementById('modal-name').value.trim();
  if (!name) { alert('Enter a player name'); return; }
  const pos = state.positions.find(p=>p.id===addingToPos);
  pos.players.push({
    name,
    bats: document.getElementById('modal-bats').value,
    status: document.getElementById('modal-status').value,
    note: document.getElementById('modal-note').value.trim(),
  });
  saveState(); renderDepth(); closeModal();
}
document.getElementById('add-modal').addEventListener('click', e => {
  if (e.target === document.getElementById('add-modal')) closeModal();
});
document.getElementById('modal-name').addEventListener('keydown', e => {
  if (e.key === 'Enter') savePlayer();
  if (e.key === 'Escape') closeModal();
});

// ============================================================
// LINEUP BUILDER
// ============================================================
function getAllBatters() {
  const seen = new Set();
  const names = [];
  state.positions.forEach(pos => {
    pos.players.forEach(p => {
      if (!seen.has(p.name)) { seen.add(p.name); names.push(p.name); }
    });
  });
  return names.sort();
}

function renderLineupBuilder() {
  const container = document.getElementById('batting-order');
  container.innerHTML = '';
  const batters = getAllBatters();
  
  state.lineup.forEach((slot, i) => {
    const row = document.createElement('div');
    row.className = 'batting-order-row';
    
    const posOptions = ['C','1B','2B','SS','3B','LF','CF','RF','DH','P']
      .map(p=>`<option value="${p}" ${p===slot.pos?'selected':''}>${p}</option>`).join('');
    const playerOptions = ['— Select —', ...batters]
      .map(n=>`<option value="${n}" ${n===slot.player?'selected':''}>${n}</option>`).join('');
    
    row.innerHTML = `
      <div class="order-num">${i+1}</div>
      <select class="rotation-select" style="width:56px;flex:0 0 56px;" onchange="updateLineupPos(${i},this.value)">
        ${posOptions}
      </select>
      <select class="lineup-select" onchange="updateLineupPlayer(${i},this.value)">
        ${playerOptions}
      </select>
    `;
    container.appendChild(row);
  });

  // Bench
  const inLineup = new Set(state.lineup.map(s=>s.player));
  const bench = getAllBatters().filter(n => !inLineup.has(n));
  const benchDiv = document.getElementById('bench-display');
  benchDiv.innerHTML = `<div class="section-title" style="margin-bottom:10px;">BENCH / AVAILABLE</div>`;
  if (bench.length === 0) {
    benchDiv.innerHTML += `<div style="color:var(--muted); font-size:13px;">All players in lineup</div>`;
  } else {
    bench.forEach(n => {
      const color = avatarColor(n);
      benchDiv.innerHTML += `
        <div style="display:flex;align-items:center;gap:8px;padding:6px 0;border-bottom:1px solid rgba(255,255,255,0.04);">
          <div class="player-avatar" style="background:${color}22;color:${color};border-color:${color}44;width:24px;height:24px;font-size:10px;">${initials(n)}</div>
          <span style="font-family:'Barlow Condensed';font-weight:700;font-size:14px;">${n}</span>
        </div>`;
    });
  }
}

function updateLineupPos(i, val) {
  state.lineup[i].pos = val;
  saveState();
}
function updateLineupPlayer(i, val) {
  state.lineup[i].player = val === '— Select —' ? '' : val;
  saveState(); renderLineupBuilder();
}

function autoFillLineup() {
  const defaults = [
    {pos:'CF', key:'CF'}, {pos:'SS', key:'SS'}, {pos:'LF', key:'LF'},
    {pos:'DH', key:'DH'}, {pos:'C', key:'C'}, {pos:'1B', key:'1B'},
    {pos:'3B', key:'3B'}, {pos:'2B', key:'2B'}, {pos:'RF', key:'RF'},
  ];
  state.lineup = defaults.map(d => {
    const pos = state.positions.find(p=>p.id===d.key);
    return {pos: d.pos, player: pos && pos.players[0] ? pos.players[0].name : ''};
  });
  saveState(); renderLineupBuilder();
}

// ============================================================
// PITCHING
// ============================================================
function getAllPitchers() {
  return [...state.rotation.map(r=>r.name), ...state.bullpen.map(b=>b.name), 'TBD'];
}

function renderPitching() {
  // Rotation
  const rotGrid = document.getElementById('rotation-grid');
  rotGrid.innerHTML = '';
  state.rotation.forEach((slot, i) => {
    const div = document.createElement('div');
    div.className = 'rotation-slot';
    const options = ['TBD','Brandon Woodruff','Colin Rea','Tobias Myers','Aaron Ashby','Jakob Junis','Freddy Peralta','Wade Miley','Corbin Burnes']
      .map(n=>`<option value="${n}" ${n===slot.name?'selected':''}>${n}</option>`).join('');
    div.innerHTML = `
      <div class="slot-num">${slot.slot} STARTER</div>
      <div class="rotation-player editable-name" contenteditable="true"
        onblur="updateRotationName(${i},this.textContent)">${slot.name}</div>
      <div style="font-size:11px;color:var(--muted);margin-top:2px;">${slot.note || '&nbsp;'}</div>
      <select class="rotation-select" onchange="updateRotationName(${i},this.value)">
        ${options}
      </select>
    `;
    rotGrid.appendChild(div);
  });

  // Bullpen
  const bpGrid = document.getElementById('bullpen-grid');
  bpGrid.innerHTML = '';
  state.bullpen.forEach((slot, i) => {
    const div = document.createElement('div');
    div.className = 'bullpen-slot';
    const roleColor = slot.role === 'CLOSER' ? 'var(--gold)' : slot.role === 'SETUP' ? 'var(--accent)' : 'var(--muted)';
    div.innerHTML = `
      <div>
        <div class="bullpen-role" style="color:${roleColor}">${slot.role}</div>
        <div class="bullpen-name editable-name" contenteditable="true"
          onblur="updateBullpenName(${i},this.textContent)">${slot.name}</div>
        <div style="font-size:10px;color:var(--muted);">${slot.throws}HP</div>
      </div>
    `;
    bpGrid.appendChild(div);
  });
}

function updateRotationName(i, val) {
  state.rotation[i].name = val.trim() || 'TBD';
  saveState(); renderPitching();
}
function updateBullpenName(i, val) {
  state.bullpen[i].name = val.trim() || 'TBD';
  saveState();
}

// ============================================================
// TABS
// ============================================================
function switchTab(name) {
  document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
  document.querySelectorAll('.panel').forEach(p => p.classList.remove('active'));
  event.target.classList.add('active');
  document.getElementById('panel-' + name).classList.add('active');
  if (name === 'lineup') renderLineupBuilder();
  if (name === 'pitching') renderPitching();
}

// ============================================================
// RESET
// ============================================================
function resetAll() {
  if (!confirm('Reset all changes to default projections?')) return;
  state = JSON.parse(JSON.stringify(defaultData));
  saveState(); renderDepth(); renderLineupBuilder(); renderPitching();
}

// ============================================================
// EXPORT NOTES
// ============================================================
function exportNotes() {
  const lnotes = document.getElementById('lineup-notes').value;
  const pnotes = document.getElementById('pitching-notes').value;
  let text = '=== MILWAUKEE BREWERS 2026 DEPTH CHART ===\n\n';
  text += '--- BATTING ORDER ---\n';
  state.lineup.forEach((s,i) => { text += `${i+1}. [${s.pos}] ${s.player}\n`; });
  text += '\n--- ROTATION ---\n';
  state.rotation.forEach(r => { text += `${r.slot}: ${r.name}\n`; });
  text += '\n--- BULLPEN ---\n';
  state.bullpen.forEach(b => { text += `${b.role}: ${b.name}\n`; });
  if (lnotes) text += '\n--- LINEUP NOTES ---\n' + lnotes + '\n';
  if (pnotes) text += '\n--- PITCHING NOTES ---\n' + pnotes + '\n';
  text += '\n--- DEPTH CHART ---\n';
  state.positions.forEach(pos => {
    text += `\n${pos.name} (${pos.abbr}):\n`;
    pos.players.forEach((p,i) => { text += `  ${i+1}. ${p.name}${p.status?' ['+p.status.toUpperCase()+']':''}\n`; });
  });
  const blob = new Blob([text], {type:'text/plain'});
  const a = document.createElement('a');
  a.href = URL.createObjectURL(blob);
  a.download = 'Brewers-2026-DepthChart.txt';
  a.click();
}

// ============================================================
// INIT
// ============================================================
renderDepth();
</script>
</body>
</html>
